<!DOCTYPE html><!--[if lte IE 8]>
<html lang="en" class="lte-ie8">
<![endif]-->
<!--[if gt IE 8]><!-->
<html lang="en">
<!--<![endif]--><head><meta charset="utf-8"><title>January 16, 2016</title><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/diary/css/global.css"><link rel="stylesheet" href="/diary/css/tomorrow.css"><link rel="stylesheet" href="/diary/css/diary.css"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-63818301-1', 'auto');
ga('send', 'pageview');</script></head><body><header class="header"><div class="index"><a href="/diary/">Index</a></div><h1>January 16, 2016</h1></header><div class="content"><div class="diary"><h3 id="mad-source-">Mad Source 源码系列</h3>
<hr>
<h4 id="jquery-new-">jQuery的无new构建：</h4>
<pre><code><span class="hljs-keyword">var</span> aQuery = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">selector, context</span>) </span>{
   <span class="hljs-keyword">return</span>  <span class="hljs-keyword">new</span> aQuery.prototype.init();
}
aQuery.prototype = {
    init: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    },
    name: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.age
    },
    age: <span class="hljs-number">20</span>
}

aQuery.prototype.init.prototype = aQuery.prototype;

<span class="hljs-built_in">console</span>.log(aQuery().name()) <span class="hljs-comment">//20</span>
</code></pre><p>实现的关键点：</p>
<pre><code>jQuery<span class="hljs-class">.fn</span><span class="hljs-class">.init</span><span class="hljs-class">.prototype</span> = jQuery.fn
</code></pre><blockquote>
<p>通过原型传递解决问题，把jQuery的原型传递给jQuery.prototype.init.prototype
换句话说jQuery的原型对象覆盖了init构造器的原型对象
因为是引用传递所以不需要担心这个循环引用的性能问题</p>
</blockquote>
<hr>
<h4 id="-">链式调用：</h4>
<p>原理：</p>
<pre><code>aQuery<span class="hljs-literal">()</span>.init<span class="hljs-literal">()</span>.name<span class="hljs-literal">()</span>

分解
a = aQuery<span class="hljs-literal">()</span>;
a.init<span class="hljs-literal">()</span>
a.name<span class="hljs-literal">()</span>
</code></pre><p>实现：</p>
<pre><code>aQuery.prototype = {
    init: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    },
    name: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>
    }
}
</code></pre><p>使用：</p>
<pre><code>aQuery.<span class="hljs-function"><span class="hljs-title">init</span><span class="hljs-params">()</span></span>.<span class="hljs-function"><span class="hljs-title">name</span><span class="hljs-params">()</span></span>
</code></pre><p>优缺点：</p>
<blockquote>
<p>优点：节省代码量，提高代码的效率，代码看起来更优雅
 缺点：所有对象的方法返回的都是对象本身，也就是说没有返回值，这不一定在任何环境下都适合。</p>
</blockquote>
<hr>
<h4 id="-">插件接口：</h4>
<p>jQuery支持自己扩展属性，这个对外提供了一个接口，jQuery.fn.extend()来对对象增加方法</p>
<hr>
<h3 id="sizzlei-">Sizzlei引擎选择器解析规则：从右到左</h3>
<p>例如：</p>
<pre><code><span class="hljs-tag">&lt;<span class="hljs-title">title</span>&gt;</span>aQuery<span class="hljs-tag">&lt;/<span class="hljs-title">title</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"sizzle.js"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"core.js"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">style</span>&gt;</span><span class="css">
       <span class="hljs-tag">div</span> &gt; <span class="hljs-tag">div</span><span class="hljs-class">.Aaron</span> <span class="hljs-tag">p</span> <span class="hljs-tag">span</span><span class="hljs-class">.red</span><span class="hljs-rules">{
            <span class="hljs-rule"><span class="hljs-attribute">color</span>:<span class="hljs-value">red</span></span>;
       }</span>
  </span><span class="hljs-tag">&lt;/<span class="hljs-title">style</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"Aaron"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">span</span>&gt;</span>s1<span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">p</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">span</span>&gt;</span>s2<span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">p</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">span</span>&gt;</span>s3<span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">p</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">'red'</span>&gt;</span>s4<span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">p</span>&gt;</span>
     <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
</code></pre><p>CSS选择器：</p>
<pre><code><span class="hljs-tag">div</span> &gt; <span class="hljs-tag">div</span><span class="hljs-class">.Aaron</span> <span class="hljs-tag">p</span> <span class="hljs-tag">span</span>.red
</code></pre><p>如果按从左到右的方式进行查找：</p>
<ol>
<li><p>先找到所有div节点</p>
</li>
<li><p>第一个div节点内找到所有的子div,并且是class=”Aaron”</p>
</li>
<li><p>然后再一次匹配p span.red等情况</p>
</li>
<li><p>遇到不匹配的情况，就必须回溯到一开始搜索的div或者p节点，然后去搜索下个节点，重复这样的过程。这样的搜索过程对于一个只是匹配很少节点的选择器来说，效率是极低的，因为我们花费了大量的时间在回溯匹配不符合规则的节点。</p>
</li>
</ol>
<p>如果换个思路呢，我们一开始过滤出跟目标节点最符合的集合出来，再在这个集合进行搜索，大大降低了搜索空间</p>
<p>从右到左来解析选择器：</p>
<p>则首先就查找到<span class='red'>的元素。</p>
<p>firefox称这种查找方式为key selector(关键字查询)，所谓的关键字就是样式规则中最后(最右边)的规则，上面的key就是span.red。</p>
<p>紧接着我们判断这些节点中的前兄弟节点是否符合p这个规则，这样就又减少了集合的元素，只有符合当前的子规则才会匹配再上一条子规则</p>
<p>要知道DOM树是一个什么样的结构，一个元素可能有若干子元素，如果每一个都去判断一下显然性能太差。而一个子元素只有一个父元素，所以找起来非常方便。你可以看看css的选择器的设计，完全是为了优化从子元素找父元素而决定的。</p>
<h4 id="-id-">疑问：id选择器的使用</h4>
<p>通过对sizzle引擎做的性能测试显示id选择器的查询效率非常高（直接调用了浏览器document.getElementById接口），所以建议在查询的时候多用id选择器，然而通常在团队开发的时候，id选择器很多时候是被禁止使用的，因为css都是全局作用域对象，id选择器自身属性要求必须满足唯一性，在沟通不当的情况下同意发生命名冲突。
如何解决这个矛盾？web component？</p>
</div></div><footer class="footer"><address class="author">Copyright &copy;<a rel="author" href="https://github.com/kevinwang04" class="author-name">kevinwang</a>-<a href="https://github.com/kevinwang04/my-diary.git" class="source-repo">Source</a></address><p>welcome to my<a href="http://home.kwang520.com" class="site-repo"> home page</a></p><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="298" height="52" src="http://music.163.com/outchain/player?type=2&amp;id=33418570&amp;auto=1&amp;height=32" style="position:fixed;top:20px;z-index:10000;right:10px;" class="163music"></iframe></footer></body></html>